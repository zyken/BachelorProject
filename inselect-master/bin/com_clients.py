"""The data/com/ directory contains Python COM client files generated by
win32com/client/makepy.py.

This script copies the appropriate files from data/com/ to win32com/gen_py/
(renamed by gencache.GetGeneratedFileName()) and adds the copied file to the
cache in win32com/gen_py/dicts.dat.

This makes it possible to build inselect without the need to have the binaries
for the various COM dependencies installed on the build machine.

The client files can be regenerated by installing the Inlite ClearImage SDK
and running

For 32-bit:
FOR /F %a IN ('python -c "import win32com.client; print(win32com.client.__path__[0])"') DO python %a\makepy.py -o data\com\clearimage32.py "ClearImage.ClearImage"

For 64-bit:
FOR /F %a IN ('python -c "import win32com.client; print(win32com.client.__path__[0])"') DO python %a\makepy.py -o data\com\clearimage64.py "ClearImage.ClearImage"
"""
import imp
import os
import shutil
import struct

import win32com

from win32com.client import gencache

module = 'clearimage{0}'.format(8 * struct.calcsize('P'))
path = 'data/com/{0}.py'.format(module)
clearimage = imp.load_source('clearimage', path)

target = gencache.GetGeneratedFileName(
    clearimage.CLSID,
    clearimage.LCID,
    clearimage.MajorVersion,
    clearimage.MinorVersion
)

target = os.path.join(
    win32com.__path__[0],
    'gen_py',
    '{0}.py'.format(target)
)

shutil.copy(path, target)

# Refresh dicts.dat
gencache.AddModuleToCache(
    clearimage.CLSID,
    clearimage.LCID,
    clearimage.MajorVersion,
    clearimage.MinorVersion
)
